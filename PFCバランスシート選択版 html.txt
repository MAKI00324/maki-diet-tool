<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>更年期世代向けダイエット計算ツール</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 700px;
            margin: 0 auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin: 0 0 30px 0;
            font-size: 22px;
        }
        
        .step {
            background: #f0f8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #8BC34A;
        }
        
        .step-title {
            background: #8BC34A;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 15px;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }
        
        input, select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #8BC34A;
        }
        
        .target-section {
            background: #fff;
            border: 2px solid #8BC34A;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .weight-loss-goal {
            background: #ff6b6b;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
        }
        
        .pace-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .pace-card {
            background: #8BC34A;
            color: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .pace-card.selected {
            border-color: #2E7D32;
            background: #4CAF50;
        }
        
        .pace-card:hover {
            background: #7CB342;
        }
        
        .pace-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .pace-detail {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .method-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .method-card {
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .method-card.selected {
            border-color: #8BC34A;
            background: #f0f8f0;
        }
        
        .method-card:hover {
            border-color: #8BC34A;
        }
        
        .safety-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 6px;
            font-size: 13px;
            margin: 10px 0;
        }
        
        .result-section {
            background: linear-gradient(135deg, #8BC34A 0%, #4CAF50 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .result-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .summary-title {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 20px;
            font-weight: bold;
        }
        
        .pfc-section {
            margin-top: 15px;
        }
        
        .pfc-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .pfc-card {
            background: rgba(255,255,255,0.2);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }
        
        .pfc-number {
            font-size: 18px;
            font-weight: bold;
        }
        
        .pfc-label {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .next-button {
            background: #8BC34A;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            transition: all 0.3s;
        }
        
        .next-button:hover {
            background: #7CB342;
            transform: translateY(-2px);
        }
        
        .warning, .success {
            border-radius: 6px;
            padding: 12px;
            margin: 15px 0;
            font-size: 14px;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .success {
            background: #d1f2eb;
            border: 1px solid #7dcea0;
            color: #186a3b;
        }
        
        @media (max-width: 600px) {
            .input-row, .pace-options {
                grid-template-columns: 1fr;
            }
            
            .method-options {
                grid-template-columns: 1fr;
            }
            
            .result-summary {
                grid-template-columns: 1fr;
            }
            
            .pfc-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌸 更年期世代向けダイエット計算ツール</h1>
        
        <!-- STEP1: 基本情報 -->
        <div class="step">
            <div class="step-title">STEP1 基本情報</div>
            
            <div class="input-row">
                <div class="input-group">
                    <label>年齢</label>
                    <input type="number" id="age" value="50" min="40" max="70">
                </div>
                <div class="input-group">
                    <label>身長（cm）</label>
                    <input type="number" id="height" value="156" min="140" max="180" step="0.1">
                </div>
            </div>
            
            <div class="input-row">
                <div class="input-group">
                    <label>現在の体重（kg）</label>
                    <input type="number" id="current-weight" value="57" min="40" max="100" step="0.1">
                </div>
                <div class="input-group">
                    <label>活動レベル</label>
                    <select id="activity">
                        <option value="1.2">あまり動かない</option>
                        <option value="1.375" selected>軽い運動</option>
                        <option value="1.55">中程度の運動</option>
                        <option value="1.725">激しい運動</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- STEP2: 目標設定 -->
        <div class="step">
            <div class="step-title">STEP2 目標体重を設定してください</div>
            
            <div class="target-section">
                <div class="input-group">
                    <label>目標体重（kg）</label>
                    <input type="number" id="target-weight" value="48" min="40" max="100" step="0.1">
                </div>
                
                <div class="weight-loss-goal" id="weight-loss-display">
                    減量目標 -9.0kg
                </div>
                
                <div class="safety-note">
                    健康的な減量ペースは、1ヶ月に現体重の3～4%以内です。それ以上は健康を害する恐れがあるのでおすすめしません。
                </div>
            </div>
        </div>
        
        <!-- STEP3: ペース選択 -->
        <div class="step">
            <div class="step-title">STEP3 どのくらいのペースでがんばりますか？</div>
            
            <div class="pace-options">
                <div class="pace-card" data-pace="slow">
                    <div class="pace-title">ゆっくり</div>
                    <div class="pace-detail">月<span id="slow-pace">1.1</span>kg（安全ペース）</div>
                </div>
                <div class="pace-card selected" data-pace="normal">
                    <div class="pace-title">がんばる</div>
                    <div class="pace-detail">月<span id="normal-pace">1.7</span>kg（推奨上限）</div>
                </div>
            </div>
        </div>
        
        <!-- STEP4: PFCバランス選択 -->
        <div class="step">
            <div class="step-title">STEP4 どのような食事バランスにしますか？</div>
            
            <div class="method-options">
                <div class="method-card" data-method="low-carb">
                    <div><strong>糖質控えめ</strong></div>
                    <div style="font-size: 12px; margin-top: 5px;">P22% F35% C43%</div>
                </div>
                <div class="method-card selected" data-method="balance">
                    <div><strong>バランス重視</strong></div>
                    <div style="font-size: 12px; margin-top: 5px;">P20% F30% C50%</div>
                </div>
                <div class="method-card" data-method="high-protein">
                    <div><strong>筋トレ向き</strong></div>
                    <div style="font-size: 12px; margin-top: 5px;">P25% F30% C45%</div>
                </div>
            </div>
        </div>
        
        <button class="next-button" onclick="calculatePlan()">目標設定を完了する</button>
        
        <div id="warnings"></div>
        
        <!-- 結果表示 -->
        <div class="result-section" id="results" style="display: none;">
            <h3 style="margin: 0 0 15px 0; font-size: 18px;">🎯 あなたの専用プラン</h3>
            
            <div class="result-summary">
                <div class="summary-card">
                    <div class="summary-title">目標達成まで</div>
                    <div class="summary-value" id="duration">6ヶ月</div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">達成予定日</div>
                    <div class="summary-value" id="target-date">2026年1月27日</div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">摂取カロリー</div>
                    <div class="summary-value" id="target-calories">1350kcal</div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">消費カロリー</div>
                    <div class="summary-value" id="tdee">1650kcal</div>
                </div>
            </div>
            
            <div class="pfc-section">
                <h4 style="margin: 0 0 10px 0; font-size: 16px;">🍽️ PFCバランス</h4>
                <div class="pfc-grid">
                    <div class="pfc-card">
                        <div class="pfc-number" id="protein-g">68</div>
                        <div class="pfc-label">たんぱく質（g）</div>
                    </div>
                    <div class="pfc-card">
                        <div class="pfc-number" id="fat-g">38</div>
                        <div class="pfc-label">脂質（g）</div>
                    </div>
                    <div class="pfc-card">
                        <div class="pfc-number" id="carb-g">186</div>
                        <div class="pfc-label">炭水化物（g）</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedPace = 'normal';
        let selectedMethod = 'balance';
        
        // ペース選択
        document.querySelectorAll('.pace-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.pace-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedPace = this.dataset.pace;
                updatePaceDisplay();
            });
        });
        
        // 方法選択
        document.querySelectorAll('.method-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.method-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedMethod = this.dataset.method;
            });
        });
        
        function updateWeightLossDisplay() {
            const currentWeight = parseFloat(document.getElementById('current-weight').value);
            const targetWeight = parseFloat(document.getElementById('target-weight').value);
            const weightLoss = currentWeight - targetWeight;
            
            document.getElementById('weight-loss-display').textContent = 
                `減量目標 ${weightLoss >= 0 ? '-' : '+'}${Math.abs(weightLoss).toFixed(1)}kg`;
            
            updatePaceDisplay();
        }
        
        function updatePaceDisplay() {
            const currentWeight = parseFloat(document.getElementById('current-weight').value);
            
            // 個別に最適化されたペース（体重の2%と3%）
            const slowPace = currentWeight * 0.02;  // 体重の2%（安全ペース）
            const normalPace = currentWeight * 0.03; // 体重の3%（推奨上限）
            
            document.getElementById('slow-pace').textContent = slowPace.toFixed(1);
            document.getElementById('normal-pace').textContent = normalPace.toFixed(1);
        }
        
        function calculateBMR(weight, height, age) {
            return Math.round(655 + (9.6 * weight) + (1.7 * height) - (4.7 * age));
        }
        
        function calculateTDEE(bmr, activity) {
            return Math.round(bmr * activity);
        }
        
        function getPFCRatios() {
            switch(selectedMethod) {
                case 'low-carb':
                    return {protein: 0.22, fat: 0.35, carb: 0.43};  // 糖質控えめ
                case 'balance':
                    return {protein: 0.20, fat: 0.30, carb: 0.50};  // バランス重視（Makiさん方式）
                case 'high-protein':
                    return {protein: 0.25, fat: 0.30, carb: 0.45};  // 筋トレ向き
                default:
                    return {protein: 0.20, fat: 0.30, carb: 0.50};
            }
        }
        
        function calculatePlan() {
            const age = parseInt(document.getElementById('age').value);
            const height = parseFloat(document.getElementById('height').value);
            const currentWeight = parseFloat(document.getElementById('current-weight').value);
            const targetWeight = parseFloat(document.getElementById('target-weight').value);
            const activity = parseFloat(document.getElementById('activity').value);
            
            const weightLoss = Math.abs(currentWeight - targetWeight);
            const bmr = calculateBMR(currentWeight, height, age);
            const tdee = calculateTDEE(bmr, activity);
            
            // 選択されたペースに基づく月間減量量（個別計算）
            const monthlyLoss = selectedPace === 'slow' ? 
                currentWeight * 0.02 :  // 体重の2%
                currentWeight * 0.03;   // 体重の3%
            
            const duration = Math.ceil(weightLoss / monthlyLoss);
            const dailyDeficit = (monthlyLoss * 7200) / 30; // 1kg = 7200kcal
            let targetCalories = Math.round(tdee - dailyDeficit);
            
            const warningsDiv = document.getElementById('warnings');
            warningsDiv.innerHTML = '';
            
            // 安全性チェック
            if (targetCalories < bmr * 1.2) {
                const safeDuration = Math.ceil(weightLoss / (currentWeight * 0.02)); // 2%ペースでの期間
                warningsDiv.innerHTML = `
                    <div class="warning">
                        💡 <strong>安全に目標達成するために</strong><br>
                        ${targetWeight}kgは素晴らしい目標です！<br>
                        より健康的に達成するため、期間を${safeDuration}ヶ月に調整しました。<br>
                        <br>
                        <strong>推奨プラン：</strong><br>
                        • 期間：${safeDuration}ヶ月（月-${(weightLoss/safeDuration).toFixed(1)}kg）<br>
                        • 無理のないペースで確実に達成<br>
                        • リバウンドしにくい体作り<br>
                        <br>
                        <small>このペースなら体に負担をかけずに理想の体重を目指せます！</small>
                    </div>
                `;
                targetCalories = Math.round(bmr * 1.2);
                // 安全な期間で再計算
                const safeDailyDeficit = (currentWeight * 0.02 * 7200) / 30;
                targetCalories = Math.round(tdee - safeDailyDeficit);
            } else {
                warningsDiv.innerHTML = `
                    <div class="success">
                        ✅ <strong>安全な設定です！</strong><br>
                        <small>この設定で継続すれば健康的に目標達成できます</small>
                    </div>
                `;
            }
            
            // 目標日計算
            const targetDate = new Date();
            targetDate.setMonth(targetDate.getMonth() + duration);
            
            // PFC計算
            const pfcRatios = getPFCRatios();
            const proteinG = Math.round(targetCalories * pfcRatios.protein / 4);
            const fatG = Math.round(targetCalories * pfcRatios.fat / 9);
            const carbG = Math.round(targetCalories * pfcRatios.carb / 4);
            
            // 結果表示
            document.getElementById('duration').textContent = `${duration}ヶ月`;
            document.getElementById('target-date').textContent = 
                `${targetDate.getFullYear()}年${targetDate.getMonth() + 1}月${targetDate.getDate()}日`;
            document.getElementById('target-calories').textContent = `${targetCalories}kcal`;
            document.getElementById('tdee').textContent = `${tdee}kcal`;
            document.getElementById('protein-g').textContent = proteinG;
            document.getElementById('fat-g').textContent = fatG;
            document.getElementById('carb-g').textContent = carbG;
            
            document.getElementById('results').style.display = 'block';
        }
        
        // リアルタイム更新
        document.getElementById('current-weight').addEventListener('input', updateWeightLossDisplay);
        document.getElementById('target-weight').addEventListener('input', updateWeightLossDisplay);
        
        // 初期表示
        updateWeightLossDisplay();
    </script>
</body>
</html>